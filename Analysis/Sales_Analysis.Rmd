---
title: "Analysis of Superstore Sales Data"
author: "Yupawadee Galasong"
date: "2023-02-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(devtools)
library(ggpubr)
library(rstatix)
```

# Importing the Dataset

The 'Superstore' dataset contains \~ 10,000 entries of sales data. The following information is recorded: order ID, order date, ship date, ship mode, customer information (name, address, segment), product information, sales, discount and profit. To begin the analysis, we import the dataset and reformat certain columns as needed.

```{r import}
Superstore <- read_csv("../Data/Superstore.csv", 
    col_types = cols(`Order Date` = col_date(format = "%m/%d/%Y"), 
        `Ship Date` = col_date(format = "%m/%d/%Y")))
head(Superstore)
```

# Calculating summary statistics

We might want to know the average sales and profits the store gained from different consumer segment.

```{r summary stats1}
#Average sales and profit grouped by customer segment and region
Superstore %>%
  group_by(Segment) %>%
  summarise(
          count = n(),
          avg_sales = mean(Sales),
          avg_profit = mean(Profit)
            )
```

The average sales and profit are quite similar. It is interesting that home office segment has lowest avaergae profit despite having the highest sales in the record. Now let's look at the maximum and minimum sales & profits generated by each region.

```{r summary stats2}
#Maximum sales and profits grouped by region
Superstore %>%
  group_by(Region) %>%
  summarise(
          count = n(),
          max_sales = max(Sales),
          min_sales = min(Sales),
          max_profit = max(Profit),
          min_profit = min(Profit)
            )
```

Alternatively, we can explore the median sales and profit generated from different product subcategory.

```{r summary stats3}
#Median sales grouped by product sub-category
Superstore %>%
  group_by(`Sub-Category`) %>%
  summarise(
          count = n(),
          median_sales = median(Sales),
          median_profit = median(Profit)
            )

```

# Visualizing sales data in the furniture category

We might want to know if sales and profit are normally distributed. We can visualize these data using histograms.

```{r histogram_untransformed}
ggplot(data = filter(Superstore, Category == "Furniture"), aes(x = Sales, fill = Segment)) + geom_histogram(binwidth = 200) + scale_fill_brewer(palette = "Pastel1") + labs(title = "Distribution of Sales in the Furniture Category")
```

The data looks left-skewed. We could apply log transformation to the sales data. We can also see that the distribution within each consumer segment is similar. The only difference is the sales volume.

```{r histogram_log_transformed, message=FALSE}
ggplot(data = filter(Superstore, Category == "Furniture"), aes(x = log(Sales), fill = Segment)) + geom_histogram(binwidth = 1) + scale_fill_brewer(palette = "Pastel1") + labs(title = "Distribution of Sales in the Furniture Category")

#Save the plot
ggsave("Histogram of Furniture Sales.png")
```

# Statistical comparison of sales data in the furniture category

Let's create a new data frame by subsetting the initial Superstore dataset.

```{r subset data}
Furniture = subset(Superstore, Category == "Furniture")
```
We want to know if which product subcategory within the furniture category generated significant sales. To get a glimpse of how the subcategories stacks up against one another, we can visualize it with side-by-side boxplots. 
```{r boxplot}
ggplot(data = Furniture, aes(x = `Sub-Category`, y = log(Sales),fill = `Sub-Category`))+ geom_boxplot()+labs(title = "Furniture Sales by Subcategories ")+scale_fill_brewer(palette = "Pastel2")
```
## Checking normality assumption
Before performing Analysis of Variance (ANOVA), we should make sure that the data meets certain assumptions, one of which is the normality assumption. Normality is generally visualized using QQplot. 
```{r}
#Add a new column of log-transformed sales to the Furniture dataframe because ggqqplot cannot accept log(Sales) as input.
Furniture$log_Sales = log(Furniture$Sales)

#QQ plot
ggqqplot(Furniture, "log_Sales", facet.by = "Sub-Category")
```
All the points fall approximately along the reference line, for each cell. So we can assume normality of the log-transformed sales data.
##  Checking the assumption of homogeneity of variances 
Levene's test can be used to check the homogeneity of variances; i.e. if variances are equal.
```{r Homogeneity of Variances, warning=FALSE}
#Displaying results in a tibble
Furniture %>% levene_test(log_Sales ~ `Sub-Category`)

```
The p-value of the Levene's test is way below 0.05, which tells us that the variances are significantly different amoung product subcategories! 
We should not be performing a typical ANOVA because the homogeneity of variance assumption is not met. However, we can st will compute run a specific kind of ANOVA that has Welch statistic. This test does not require the assumption of equal variances.

```{r}

```

```{r}
devtools::session_info()
```
